<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper Content Manager</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>

        /* Basic button  */
    .custom-button {
        background-color: rgb(21, 137, 239);
        color: white;
        height: 50px;
        width: 150px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .custom-button:hover {
        background-color: rgb(17, 117, 206);
        transform: scale(1.03);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .custom-button:active {
        transform: scale(0.98);
    }


        /* Custom font for a clean look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Styling for the JSON output area */
        #jsonOutput {
            min-height: 200px;
            background-color: #1f2937; /* Dark background for code */
            color: #e5e7eb; /* Light text color */
            font-family: 'monospace';
            font-size: 0.875rem; /* sm text size */
            line-height: 1.5;
            overflow-x: auto; /* Allow horizontal scrolling for long lines */
        }
        /* Basic button styling */
        .btn {
            @apply px-4 py-2 rounded-lg font-semibold shadow-md transition-all duration-200;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50;
        }
        .btn-secondary {
            @apply bg-gray-300 text-gray-800 hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50;
        }
        .btn-danger {
            @apply bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50;
        }
        
        /* Live preview animation */
        #livePreviewSection {
            transition: all 0.3s ease-in-out;
        }
        
        .preview-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Image preview styling */
        #previewImage {
            transition: all 0.3s ease-in-out;
            object-fit: cover;
        }
        
        #previewImage:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        #imagePreviewContainer {
            transition: all 0.3s ease-in-out;
        }
        
        /* Premium badge styling */
        .premium-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .premium-badge.standard {
            background-color: #e5e7eb;
            color: #6b7280;
        }
        
        .premium-badge.premium {
            background-color: #fbbf24;
            color: #92400e;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold text-gray-800 mb-2 text-center">Wallpaper Content Manager</h1>
        <div id="statusIndicator" class="text-center mb-6">
            <span id="statusText" class="text-sm text-gray-500">Connecting to server...</span>
        </div>

        <form id="wallpaperForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div>
                <label for="wallpaperUrl" class="block text-gray-700 text-sm font-bold mb-2">
                    Wallpaper URL:
                </label>
                <input type="url" id="wallpaperUrl" name="wallpaperUrl" required
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
            </div>

            <div>
                <label for="category" class="block text-gray-700 text-sm font-bold mb-2">
                    Category:
                </label>
                <select id="category" name="category" required
                        class="shadow border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                   <option value="">Select a Category</option>
<option value="Abstract">Abstract</option>
<option value="Animal">Animal</option>
<option value="Anime">Anime</option>
<option value="Arts">Arts</option>
<option value="Astronomy">Astronomy</option>
<option value="B&W">B&W</option>
<option value="Babies & Kids">Babies & Kids</option>
<option value="Birds">Birds</option>
<option value="Bokeh">Bokeh</option>
<option value="Cars">Cars</option>
<option value="Comics">Comics</option>
<option value="Country">Country</option>
<option value="City & Buildings">City & Buildings</option>
<option value="Colorful">Colorful</option>
<option value="Dusk">Dusk</option>
<option value="Fashion">Fashion</option>
<option value="Festival">Festival</option>
<option value="Flower">Flower</option>
<option value="Funny">Funny</option>
<option value="Food & Drink">Food & Drink</option>
<option value="Geometric">Geometric</option>
<option value="Girly">Girly</option>
<option value="Love">Love</option>
<option value="Majestic">Majestic</option>
<option value="Memes">Memes</option>
<option value="Mountains">Mountains</option>
<option value="Movie">Movie</option>
<option value="Movie">Music</option>
<option value="Nature">Nature</option>
<option value="Night">Night</option>
<option value="Ocean">Ocean</option>
<option value="Premium">Premium</option>
<option value="Quotes">Quotes</option>
<option value="Season">Season</option>
<option value="sports">Sports</option>
<option value="Vehicles">Vehicles</option>
<option value="Vintage and Retro">Vintage and Retro</option>


                </select>
            </div>

            <div class="md:col-span-2">
                <label for="description" class="block text-gray-700 text-sm font-bold mb-2">
                    Description (for search):
                </label>
                <textarea id="description" name="description" rows="3" required
                          class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500"></textarea>
            </div>

            <div class="md:col-span-2">
                <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="checkbox" id="premium" name="premium" 
                           class="w-5 h-5 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                    <span class="text-gray-700 text-sm font-bold">
                        Premium Wallpaper
                        <span class="text-gray-500 font-normal text-xs block">Check this box to mark as premium content</span>
                    </span>
                </label>
            </div>

            <div class="md:col-span-2 flex justify-center mt-4">
           <button type="submit" class="custom-button">
    Add Wallpaper
</button>

            </div>
        </form>

        <!-- Live Preview Section -->
        <div id="livePreviewSection" class="mb-6 hidden">
            <h2 class="text-lg font-bold text-gray-800 mb-3 text-center">Live Preview</h2>
            <div class="bg-gray-50 p-4 rounded-lg border">
                <!-- Image Preview -->
                <div id="imagePreviewContainer" class="mb-4 hidden">
                    <div class="text-center">
                        <div class="relative inline-block">
                            <img id="previewImage" class="max-w-full max-h-64 rounded-lg shadow-md border-2 border-gray-200" 
                                 style="display: none;" alt="Wallpaper Preview">
                            <div id="imageLoadingSpinner" class="hidden absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            </div>
                        </div>
                        <div id="imageError" class="hidden mt-2 text-red-600 text-sm">
                            ‚ùå Could not load image preview
                        </div>
                        <div class="mt-2 text-xs text-gray-500">Image Preview</div>
                    </div>
                </div>

                <!-- Data Preview -->
                <div class="bg-white p-3 rounded-lg border-l-4 border-blue-500">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div>
                            <span class="font-semibold text-gray-600">Category:</span>
                            <span id="previewCategory" class="text-gray-800 ml-2">Not selected</span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-600">Premium:</span>
                            <span id="previewPremium" class="ml-2">
                                <span class="premium-badge">Standard</span>
                            </span>
                        </div>
                        <div class="md:col-span-2">
                            <span class="font-semibold text-gray-600">Timestamp:</span>
                            <span id="previewTimestamp" class="text-gray-500 ml-2 text-xs">Will be auto-generated</span>
                        </div>
                    </div>
                    <div class="mt-2">
                        <div class="font-semibold text-gray-600 text-sm">Description:</div>
                        <div id="previewDescription" class="text-gray-800 mt-1">No description entered</div>
                    </div>
                    <div class="mt-2">
                        <div class="font-semibold text-gray-600 text-sm">URL:</div>
                        <div id="previewUrl" class="text-blue-600 text-xs mt-1 break-all">No URL entered</div>
                    </div>
                    <div class="mt-2">
                        <div class="font-semibold text-gray-600 text-sm">Generated ID:</div>
                        <div id="previewId" class="text-gray-500 text-xs mt-1 font-mono">Will be auto-generated (UUID)</div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <span class="text-xs text-gray-500">This is how your wallpaper entry will appear</span>
                </div>
            </div>
        </div>

        <div class="mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Search & Manage Wallpapers</h2>
            
            <div class="mb-4">
                <div class="flex gap-2">
                    <input type="text" id="searchInput" placeholder="Search by description or category..."
                           class="flex-1 shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                    <button id="searchButton" class="btn btn-primary">Search</button>
                    <button id="showAllButton" class="btn btn-secondary">Show All</button>
                </div>
            </div>

            <div id="searchResults" class="hidden mb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Search Results</h3>
                <div id="resultsList" class="space-y-2 max-h-60 overflow-y-auto"></div>
            </div>
        </div>

        <div class="mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Current JSON Data (Auto-saved to wallpaper.json)</h2>
            <pre id="jsonOutput" class="p-4 rounded-lg overflow-auto"></pre>
        </div>

        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <button id="copyButton" class="btn btn-secondary flex-1">
                Copy Current Data
            </button>
            <button id="downloadButton" class="btn btn-secondary flex-1">
                Download JSON Backup
            </button>
            <button id="clearButton" class="btn btn-danger flex-1">
                Clear All Data
            </button>
        </div>

        <div id="messageBox" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg hidden">
            Copied to clipboard!
        </div>
    </div>

    <script>
        // Array to store all wallpaper data (loaded from server)
        let wallpaperData = [];

        // Get references to DOM elements
        const wallpaperForm = document.getElementById('wallpaperForm');
        const jsonOutput = document.getElementById('jsonOutput');
        const copyButton = document.getElementById('copyButton');
        const downloadButton = document.getElementById('downloadButton');
        const clearButton = document.getElementById('clearButton');
        const messageBox = document.getElementById('messageBox');
        
        // Search elements
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const showAllButton = document.getElementById('showAllButton');
        const searchResults = document.getElementById('searchResults');
        const resultsList = document.getElementById('resultsList');
        
        // Live preview elements
        const livePreviewSection = document.getElementById('livePreviewSection');
        const previewCategory = document.getElementById('previewCategory');
        const previewDescription = document.getElementById('previewDescription');
        const previewUrl = document.getElementById('previewUrl');
        const previewId = document.getElementById('previewId');
        const previewTimestamp = document.getElementById('previewTimestamp');
        const previewPremium = document.getElementById('previewPremium');
        
        // Image preview elements
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const previewImage = document.getElementById('previewImage');
        const imageLoadingSpinner = document.getElementById('imageLoadingSpinner');
        const imageError = document.getElementById('imageError');
        
        // Form input elements for live preview
        const urlInput = document.getElementById('wallpaperUrl');
        const categorySelect = document.getElementById('category');
        const descriptionInput = document.getElementById('description');
        const premiumCheckbox = document.getElementById('premium');

        // API base URL
        const API_BASE = '/api';

        // Function to update the JSON preview area
        function updateJsonPreview() {
            // Pretty-print the JSON for readability
            jsonOutput.textContent = JSON.stringify(wallpaperData, null, 2);
        }

        // Function to update status indicator
        function updateStatus(message, isConnected = true) {
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            if (isConnected) {
                statusText.className = 'text-sm text-green-600';
            } else {
                statusText.className = 'text-sm text-red-600';
            }
        }

        // Function to load wallpapers from server
        async function loadWallpapers(page = 1, limit = 50) {
            try {
                updateStatus('Loading data...', false);
                const response = await fetch(`${API_BASE}/wallpapers?page=${page}&limit=${limit}`);
                if (response.ok) {
                    const data = await response.json();
                    wallpaperData = data.wallpapers || data; // Handle both new and old API responses
                    
                    updateJsonPreview();
                    
                    // Display pagination info if available
                    if (data.pagination) {
                        updateStatus(`Connected ‚Ä¢ Page ${data.pagination.currentPage}/${data.pagination.totalPages} ‚Ä¢ ${data.pagination.totalItems} total wallpapers`);
                    } else {
                        updateStatus(`Connected ‚Ä¢ ${wallpaperData.length} wallpapers loaded`);
                    }
                } else {
                    console.error('Failed to load wallpapers');
                    updateStatus('Failed to load data', false);
                    showMessage('Failed to load existing wallpapers', true);
                }
            } catch (error) {
                console.error('Error loading wallpapers:', error);
                updateStatus('Server offline', false);
                showMessage('Error connecting to server', true);
            }
        }

        // Handle form submission
        wallpaperForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            // Get input values
            const url = document.getElementById('wallpaperUrl').value;
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;
            const premium = document.getElementById('premium').checked;

            // Show loading state
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Adding...';
            submitButton.disabled = true;

            try {
                // Send data to server
                const response = await fetch(`${API_BASE}/wallpapers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        category: category,
                        description: description,
                        premium: premium
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showMessage(`Wallpaper added successfully! Total: ${result.total}`);
                    
                    // Reload wallpapers to get updated data
                    await loadWallpapers();
                    
                    // Clear the form fields and hide preview
                    wallpaperForm.reset();
                    livePreviewSection.classList.add('hidden');
                    hideImagePreview();
                    document.getElementById('wallpaperUrl').focus(); // Focus back to the first input
                } else {
                    const error = await response.json();
                    if (response.status === 409) {
                        // Duplicate URL error
                        showMessage(`URL already exists! Added on ${new Date(error.existing.timestamp).toLocaleDateString()} in category "${error.existing.category}"`, true);
                    } else {
                        showMessage(error.error || 'Failed to add wallpaper', true);
                    }
                }
            } catch (error) {
                console.error('Error adding wallpaper:', error);
                showMessage('Error connecting to server', true);
            } finally {
                // Reset button state
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        });

        // Handle Copy to Clipboard button click
        copyButton.addEventListener('click', function() {
            const jsonString = jsonOutput.textContent;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(jsonString)
                    .then(() => {
                        showMessage("Copied to clipboard!");
                    })
                    .catch(err => {
                        console.error('Failed to copy text: ', err);
                        showMessage("Failed to copy!", true);
                    });
            } else {
                // Fallback for older browsers (less reliable in iframes)
                const textarea = document.createElement('textarea');
                textarea.value = jsonString;
                textarea.style.position = 'fixed'; // Avoid scrolling to bottom
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                try {
                    document.execCommand('copy');
                    showMessage("Copied to clipboard!");
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                    showMessage("Failed to copy!", true);
                }
                document.body.removeChild(textarea);
            }
        });

        // Handle Download JSON button click
        downloadButton.addEventListener('click', function() {
            const jsonString = jsonOutput.textContent;
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wallpapers.json'; // File name
            document.body.appendChild(a); // Required for Firefox
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url); // Clean up
        });

        // Handle Clear All Data button click
        clearButton.addEventListener('click', async function() {
            if (confirm("Are you sure you want to clear all wallpaper data? This cannot be undone.")) {
                try {
                    // Show loading state
                    clearButton.textContent = 'Clearing...';
                    clearButton.disabled = true;

                    const response = await fetch(`${API_BASE}/wallpapers`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        wallpaperData = []; // Reset the array
                        updateJsonPreview(); // Update the preview
                        showMessage("All data cleared!");
                    } else {
                        const error = await response.json();
                        showMessage(error.error || 'Failed to clear data', true);
                    }
                } catch (error) {
                    console.error('Error clearing data:', error);
                    showMessage('Error connecting to server', true);
                } finally {
                    // Reset button state
                    clearButton.textContent = 'Clear All Data';
                    clearButton.disabled = false;
                }
            }
        });

        // Function to show a temporary message
        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
            if (isError) {
                messageBox.classList.remove('bg-green-500');
                messageBox.classList.add('bg-red-500');
            } else {
                messageBox.classList.remove('bg-red-500');
                messageBox.classList.add('bg-green-500');
            }
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000); // Hide after 3 seconds
        }

        // Live preview functionality
        let imageLoadTimeout;
        
        function updateLivePreview() {
            const url = urlInput.value.trim();
            const category = categorySelect.value;
            const description = descriptionInput.value.trim();
            const premium = premiumCheckbox.checked;
            
            // Show/hide preview section based on input
            const hasInput = url || category || description;
            const wasHidden = livePreviewSection.classList.contains('hidden');
            
            if (hasInput) {
                if (wasHidden) {
                    livePreviewSection.classList.remove('hidden');
                    livePreviewSection.classList.add('preview-slide-in');
                    setTimeout(() => {
                        livePreviewSection.classList.remove('preview-slide-in');
                    }, 300);
                }
            } else {
                livePreviewSection.classList.add('hidden');
                hideImagePreview();
                return;
            }
            
            // Update preview content
            previewCategory.textContent = category || 'Not selected';
            previewDescription.textContent = description || 'No description entered';
            previewUrl.textContent = url || 'No URL entered';
            previewTimestamp.textContent = new Date().toISOString();
            
            // Update premium status
            const premiumBadge = previewPremium.querySelector('.premium-badge');
            if (premium) {
                premiumBadge.textContent = 'Premium';
                premiumBadge.className = 'premium-badge premium';
            } else {
                premiumBadge.textContent = 'Standard';
                premiumBadge.className = 'premium-badge standard';
            }
            
            // Generate a sample UUID for preview (this won't be the actual ID)
            const sampleId = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            previewId.textContent = sampleId;
            
            // Handle image preview
            if (url && isValidImageUrl(url)) {
                loadImagePreview(url);
            } else {
                hideImagePreview();
            }
            
            // Update styling based on completeness
            const isComplete = url && category && description;
            const previewSection = livePreviewSection.querySelector('.bg-white');
            const statusText = livePreviewSection.querySelector('span:last-child');
            
            if (isComplete) {
                previewSection.className = 'bg-white p-3 rounded-lg border-l-4 border-green-500';
                statusText.textContent = '‚úÖ Ready to add - all fields completed';
                statusText.className = 'text-xs text-green-600 font-medium';
            } else {
                previewSection.className = 'bg-white p-3 rounded-lg border-l-4 border-orange-500';
                statusText.textContent = '‚ö†Ô∏è Complete all fields to add this wallpaper';
                statusText.className = 'text-xs text-orange-600 font-medium';
            }
        }

        // Function to check if URL might be an image
        function isValidImageUrl(url) {
            try {
                const urlObj = new URL(url);
                const pathname = urlObj.pathname.toLowerCase();
                const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg', '.bmp', '.ico'];
                
                // Check if URL ends with image extension
                const hasImageExtension = imageExtensions.some(ext => pathname.endsWith(ext));
                
                // Also allow URLs that might be images but don't have extensions (like some CDN URLs)
                const mightBeImage = url.includes('image') || url.includes('img') || url.includes('photo') || 
                                   url.includes('wallpaper') || hasImageExtension;
                
                return mightBeImage;
            } catch (error) {
                return false;
            }
        }

        // Function to load image preview
        function loadImagePreview(url) {
            // Clear previous timeout
            if (imageLoadTimeout) {
                clearTimeout(imageLoadTimeout);
            }
            
            // Show loading spinner
            imagePreviewContainer.classList.remove('hidden');
            imageLoadingSpinner.classList.remove('hidden');
            previewImage.style.display = 'none';
            imageError.classList.add('hidden');
            
            // Create a new image element for testing
            const testImg = new Image();
            
            // Set timeout for loading
            imageLoadTimeout = setTimeout(() => {
                hideImagePreview();
                showImageError();
            }, 10000); // 10 second timeout
            
            testImg.onload = function() {
                clearTimeout(imageLoadTimeout);
                previewImage.src = url;
                previewImage.style.display = 'block';
                imageLoadingSpinner.classList.add('hidden');
                imageError.classList.add('hidden');
            };
            
            testImg.onerror = function() {
                clearTimeout(imageLoadTimeout);
                showImageError();
            };
            
            // Start loading
            testImg.src = url;
        }

        // Function to hide image preview
        function hideImagePreview() {
            imagePreviewContainer.classList.add('hidden');
            previewImage.style.display = 'none';
            imageLoadingSpinner.classList.add('hidden');
            imageError.classList.add('hidden');
            
            if (imageLoadTimeout) {
                clearTimeout(imageLoadTimeout);
            }
        }

        // Function to show image error
        function showImageError() {
            imageLoadingSpinner.classList.add('hidden');
            previewImage.style.display = 'none';
            imageError.classList.remove('hidden');
        }

        // Add event listeners for live preview
        urlInput.addEventListener('input', updateLivePreview);
        categorySelect.addEventListener('change', updateLivePreview);
        descriptionInput.addEventListener('input', updateLivePreview);
        premiumCheckbox.addEventListener('change', updateLivePreview);

        // Update preview timestamp every second to show live time
        setInterval(() => {
            if (!livePreviewSection.classList.contains('hidden')) {
                previewTimestamp.textContent = new Date().toISOString();
            }
        }, 1000);

        // Search functionality
        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) {
                showMessage('Please enter a search term', true);
                return;
            }

            try {
                searchButton.textContent = 'Searching...';
                searchButton.disabled = true;

                const response = await fetch(`${API_BASE}/wallpapers/search?q=${encodeURIComponent(query)}`);
                
                if (response.ok) {
                    const result = await response.json();
                    displaySearchResults(result);
                } else {
                    const error = await response.json();
                    showMessage(error.error || 'Search failed', true);
                }
            } catch (error) {
                console.error('Error searching:', error);
                showMessage('Error connecting to server', true);
            } finally {
                searchButton.textContent = 'Search';
                searchButton.disabled = false;
            }
        }

        // Display search results
        function displaySearchResults(result) {
            if (result.results.length === 0) {
                resultsList.innerHTML = '<p class="text-gray-500 text-center py-4">No wallpapers found matching your search.</p>';
            } else {
                resultsList.innerHTML = result.results.map(wallpaper => `
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-800">${wallpaper.category}</p>
                                <p class="text-gray-600 text-sm">${wallpaper.description}</p>
                                <p class="text-gray-400 text-xs">Added: ${new Date(wallpaper.timestamp).toLocaleDateString()}</p>
                                <p class="text-blue-600 text-xs break-all">${wallpaper.url.substring(0, 80)}${wallpaper.url.length > 80 ? '...' : ''}</p>
                            </div>
                            <button onclick="deleteWallpaper('${wallpaper.id}')" 
                                    class="btn btn-danger text-xs px-2 py-1 ml-2">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
            
            searchResults.classList.remove('hidden');
            showMessage(`Found ${result.results.length} wallpaper(s) matching "${result.query}"`);
        }

        // Delete wallpaper function
        async function deleteWallpaper(id) {
            if (!confirm('Are you sure you want to delete this wallpaper?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/wallpapers/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    const result = await response.json();
                    showMessage(`Wallpaper deleted successfully! ${result.remaining} remaining`);
                    
                    // Refresh data
                    await loadWallpapers();
                    
                    // If search results are showing, refresh them too
                    if (!searchResults.classList.contains('hidden')) {
                        performSearch();
                    }
                } else {
                    const error = await response.json();
                    showMessage(error.error || 'Failed to delete wallpaper', true);
                }
            } catch (error) {
                console.error('Error deleting wallpaper:', error);
                showMessage('Error connecting to server', true);
            }
        }

        // Make deleteWallpaper globally accessible
        window.deleteWallpaper = deleteWallpaper;

        // Event listeners for search
        searchButton.addEventListener('click', performSearch);
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        showAllButton.addEventListener('click', () => {
            searchResults.classList.add('hidden');
            searchInput.value = '';
            showMessage('Showing all wallpapers');
        });

        // Load wallpapers when page loads
        loadWallpapers();
    </script>
</body>
</html>